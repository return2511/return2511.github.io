<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />




  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png?v=5.1.4">






  <meta name="keywords" content="js,offline," />










<meta name="description" content="js红宝书第23章–离线应用与客户端存储的读书分享，在此做一个记录。">
<meta name="keywords" content="js,offline">
<meta property="og:type" content="article">
<meta property="og:title" content="离线应用与客户端存储">
<meta property="og:url" content="http://yoursite.com/js-offline.html">
<meta property="og:site_name" content="啤酒泡泡">
<meta property="og:description" content="js红宝书第23章–离线应用与客户端存储的读书分享，在此做一个记录。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/7.10.4.jpg">
<meta property="og:updated_time" content="2018-04-22T14:12:45.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="离线应用与客户端存储">
<meta name="twitter:description" content="js红宝书第23章–离线应用与客户端存储的读书分享，在此做一个记录。">
<meta name="twitter:image" content="http://yoursite.com/7.10.4.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":5},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/js-offline.html"/>





  <title>离线应用与客户端存储 | 啤酒泡泡</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5107b76fc62676dd7b1eccd4126ad6df";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">啤酒泡泡</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
  <script>
    (function(){
        if(''){
            if (prompt('time we together (format: yyyymmdd)') !== ''){
                alert('sorry,it`s not today!');
                history.back();
            }
        }
    })();
</script>
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/js-offline.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="洪杨">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="啤酒泡泡">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">离线应用与客户端存储</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-31T00:01:00+08:00">
                2018-03-31
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-04-22T22:12:45+08:00">
                2018-04-22
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 阅读次数
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>js红宝书第23章–离线应用与客户端存储的读书分享，在此做一个记录。</p>
</blockquote>
<a id="more"></a>
<h2 id="web应用和传统客户端的比较"><a href="#web应用和传统客户端的比较" class="headerlink" title="web应用和传统客户端的比较"></a>web应用和传统客户端的比较</h2><ul>
<li><p>web应用 </p>
<ul>
<li>无需安装程序，通过浏览器访问</li>
<li>消耗很小的用户硬盘空间或者无</li>
<li>update容易，用户端不需要更新</li>
<li>基于浏览器，所以是跨平台的<br><br></li>
</ul>
</li>
<li><p>传统客户端 </p>
<ul>
<li>减轻服务端负担</li>
<li>客户端存储部分资源，节省流量</li>
<li>安全性比web应用高</li>
<li>用户体验好</li>
</ul>
</li>
</ul>
<p>总体来说web程序更灵活，更方便，更易用，<br>在网络带宽及速度不断提高的情况下，web应用则越来越流行</p>
<h2 id="开发离线应用"><a href="#开发离线应用" class="headerlink" title="开发离线应用"></a>开发离线应用</h2><ul>
<li>首先确定设备是否能上网（离线检测） {:&amp;.rollIn}</li>
<li>其次应用必须能访问一定资源（使用离线缓存）</li>
<li>最后有本地空间用于保存数据（浏览器保存数据）</li>
</ul>
<h2 id="离线检测"><a href="#离线检测" class="headerlink" title="离线检测"></a>离线检测</h2><p>使用h5属性：navigator.onLine</p>
<ul>
<li>true表示可以上网</li>
<li>false表示不可上网</li>
</ul>
<p>通常使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(navigator.onLine) &#123;</span><br><span class="line">    //正常工作</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    //执行离线状态</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="离线检测-h5事件"><a href="#离线检测-h5事件" class="headerlink" title="离线检测 h5事件"></a>离线检测 h5事件</h2><p> HTML5定义两个事件：online和offline，当网络状态变化时，分别触发这两个事件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(window, &apos;online&apos;, function () &#123;</span><br><span class="line">    console.log(&apos;online&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">EventUtil.addHandler(window, &apos;offline&apos;, function () &#123;</span><br><span class="line">    console.log(&apos;offline&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="应用缓存"><a href="#应用缓存" class="headerlink" title="应用缓存"></a>应用缓存</h2><p>HTML5 的应用缓存（application cache），简称 appcache，是专门为开发离线 Web 应用而设计的。</p>
<h2 id="描述文件以及使用"><a href="#描述文件以及使用" class="headerlink" title="描述文件以及使用"></a>描述文件以及使用</h2><p>该文件用于描述需要下在和缓存的资源，其文件后缀为 manifest，不过现在推荐用 appcache。在文件中可以通过描述指定资源缓存的规则，下面是一个简单的示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CACHE MANIFEST</span><br><span class="line"># Comment</span><br><span class="line"></span><br><span class="line">file.js</span><br><span class="line">file.css</span><br></pre></td></tr></table></figure></p>
<p>1: 使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;html manifest=&quot;/filename.manifest&quot; &gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="applicationCache-对象属性"><a href="#applicationCache-对象属性" class="headerlink" title="applicationCache 对象属性"></a>applicationCache 对象属性</h2><ul>
<li>属性：通过 applicationCache.status 可以知道缓存的状态，该属性返回一个常量</li>
</ul>
<table>
<thead>
<tr>
<th>状态码</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>无缓存</td>
</tr>
<tr>
<td>1</td>
<td>闲置，即应用缓存未得到更新</td>
</tr>
<tr>
<td>2</td>
<td>检测中，即正在下载描述文件并检测更新</td>
</tr>
<tr>
<td>3</td>
<td>下载中，即应用缓存正在下载描述文件中指定的资源</td>
</tr>
<tr>
<td>4</td>
<td>更新完成，通过 swapCache() 来使用</td>
</tr>
<tr>
<td>5</td>
<td>废弃，即应用缓存描述文件已经不在，因此页面无法再访问应用缓存</td>
</tr>
</tbody>
</table>
<h2 id="applicationCache-对象事件"><a href="#applicationCache-对象事件" class="headerlink" title="applicationCache 对象事件"></a>applicationCache 对象事件</h2><table>
<thead>
<tr>
<th>事件名</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>checking</td>
<td>浏览器为应用缓存检测更新时触发</td>
</tr>
<tr>
<td>error</td>
<td>检测更新或下载出错时触发</td>
</tr>
<tr>
<td>noupdate</td>
<td>检测描述文件发现文件无更新时触发</td>
</tr>
<tr>
<td>downloading</td>
<td>开始下载资源时触发</td>
</tr>
<tr>
<td>progress</td>
<td>下载期间继续不断触发</td>
</tr>
<tr>
<td>updateready</td>
<td>下载完成且可通过 swapCache() 使用是触发</td>
</tr>
<tr>
<td>cached</td>
<td>在应用缓存完整可用是触发</td>
</tr>
</tbody>
</table>
<h2 id="applicationCache-对象方法"><a href="#applicationCache-对象方法" class="headerlink" title="applicationCache 对象方法"></a>applicationCache 对象方法</h2><table>
<thead>
<tr>
<th>方法名</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>swapCache()</td>
<td>启用新缓存</td>
</tr>
<tr>
<td>update()</td>
<td>检查描述文件是否更新，如果更新继续执行后续操作</td>
</tr>
</tbody>
</table>
<h2 id="Cookie（HTTP-Cookie）"><a href="#Cookie（HTTP-Cookie）" class="headerlink" title="Cookie（HTTP Cookie）"></a>Cookie（HTTP Cookie）</h2><ul>
<li>最初是用于存储会话信息。该标准要求服务器对任意HTTP请求发送Set-Cookie HTTP头作为相应的一部分，其中包括会话信息。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 ok</span><br><span class="line">Content-type: text/html</span><br><span class="line">Set-Cookie: name=value</span><br><span class="line">Other-header: other-header-value</span><br></pre></td></tr></table></figure>
<ul>
<li>其中name和value在传送时都必须是URL编码的。</li>
</ul>
<h2 id="Cookie-限制"><a href="#Cookie-限制" class="headerlink" title="Cookie 限制"></a>Cookie 限制</h2><ul>
<li>cookie在性质上是绑定在特定的域名下的。 {:&amp;.rollIn}</li>
<li>当设定了一个cookie后，再给创建它的域名发送请求时，request header会包含所有cookie。</li>
<li>这个限制确保了存储在cookie中的信息只能让批准的接受者访问，而无法被其他域访问</li>
<li>cookie在客户端计算机大小和数量都有限制 根据浏览器不同单个域下最多20-50个 整个cookie长度限制在2095b</li>
</ul>
<h2 id="Cookie-结构"><a href="#Cookie-结构" class="headerlink" title="Cookie 结构"></a>Cookie 结构</h2><ul>
<li>名称name： 唯一确定一个cookie必须经过url编码 {:&amp;.rollIn}</li>
<li>值value： cookie中存储的字符串也必须经过url编码</li>
<li>域domain： 在哪个域下是有效的，默认是设置cookie的域</li>
<li>路径path： 可以指定域中的路径</li>
<li>失效时间expire： Cookie何时被删除的时间戳</li>
<li>安全标志secure： 如果设置必须用SSL连接才能发送到服务器</li>
</ul>
<h2 id="Cookie-结构-1"><a href="#Cookie-结构-1" class="headerlink" title="Cookie 结构"></a>Cookie 结构</h2><ul>
<li>secure是一个只包含secure的单词,唯一一个非名值对的部分。</li>
<li>另外只有名值对儿才会被发送到服务器，其他参数都是服务器给浏览器的指示。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 ok</span><br><span class="line">Content-type: text/html</span><br><span class="line">Set-Cookie: name=value; domain=.ctrip.com; path=/; secure</span><br><span class="line">Other-header: other-header-value</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="javascript中的Cookie"><a href="#javascript中的Cookie" class="headerlink" title="javascript中的Cookie"></a>javascript中的Cookie</h2><ul>
<li>js中使用用BOM的document.cookie接口操作cookie</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//返回所有cookie字符串 ;需要进一步分割</span><br><span class="line">consile.log(document.cookie);//&quot;a=b;c=d&quot;</span><br><span class="line"></span><br><span class="line">//并不会覆盖原来的cookie 除非名称已经存在</span><br><span class="line">document.cookie=&quot;key=value&quot;;</span><br></pre></td></tr></table></figure>
<ul>
<li>因其读写操作比较麻烦，还需要进行urlencode，封装了CookieUtil对象来处理cookie的读、写、删除操作</li>
</ul>
<h2 id="JavaScript-Cookie操作扩展"><a href="#JavaScript-Cookie操作扩展" class="headerlink" title="JavaScript Cookie操作扩展"></a>JavaScript Cookie操作扩展</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">var CookieUtil = &#123;</span><br><span class="line">    get: function(name) &#123;</span><br><span class="line">        var cookie = document.cookie;</span><br><span class="line">        var cookieName = encodeURIComponent(name) + &quot;=&quot;;</span><br><span class="line">        var start = cookie.indexOf(cookieName);</span><br><span class="line">        var value = null;</span><br><span class="line">        if (start &gt; -1)</span><br><span class="line">        &#123;</span><br><span class="line">            var end = cookie.indexOf(&quot;;&quot;, start);</span><br><span class="line">            if (end == -1)</span><br><span class="line">                end = cookie.length;</span><br><span class="line">            value = decodeURIComponent(cookie.substring(start + cookieName.length, end));</span><br><span class="line">        &#125;</span><br><span class="line">        return value;</span><br><span class="line">    &#125;,</span><br><span class="line">    set: function(name, value, expires, path, domain, secure) &#123;</span><br><span class="line">        var cookieText = encodeURIComponent(name) + &quot;=&quot; + encodeURIComponent(value);</span><br><span class="line">        if (expires instanceof Date)</span><br><span class="line">            cookieText += &quot;; expires=&quot; + expires.toGMTString();</span><br><span class="line">        if (path)</span><br><span class="line">            cookieText += &quot;; path=&quot; + path;</span><br><span class="line">        if (domain)</span><br><span class="line">            cookieText += &quot;; domain=&quot; + domain;</span><br><span class="line">        if (secure)</span><br><span class="line">            cookieText += &quot;; secure&quot;;</span><br><span class="line">            </span><br><span class="line">        document.cookie = cookieText;</span><br><span class="line">    &#125;,</span><br><span class="line">    unset: function(name, path, domain, secure) &#123;</span><br><span class="line">        this.set(name, &quot;&quot;, new Date(0), path, domain, secure);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="子cookie"><a href="#子cookie" class="headerlink" title="子cookie"></a>子cookie</h2><ul>
<li>为了绕开浏览器对单域名下面的cookie的个数限制，使用子cookie</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key=subKey1=subValue1&amp;subKey2=subValue2;</span><br></pre></td></tr></table></figure>
<ul>
<li>其原理是在value中包含子cookie；但是虽然绕过了数量的限制另一方面却增加了cookie的长度。</li>
<li>special tip : 因为cookie是不安全的，所以用户敏感数据不要存在cookie中。</li>
</ul>
<h2 id="IE用户数据"><a href="#IE用户数据" class="headerlink" title="IE用户数据"></a>IE用户数据</h2><ul>
<li>在IE5中，微软通过自定义行为引入了持久化用户数据的概念。允许每个文档最多128K，每个域名最多1MB的数据。</li>
<li>首先在某个元素上指定userData行为</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&quot;behavior:url(#default#userData)&quot; id=&quot;dataStore&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h2 id="IE用户数据的操作"><a href="#IE用户数据的操作" class="headerlink" title="IE用户数据的操作"></a>IE用户数据的操作</h2><ul>
<li><p>写入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var dataStore = document.getElementById(&quot;dataStore&quot;);</span><br><span class="line">dataStore.setAttribute(&quot;name&quot;,&quot;ctrip&quot;);</span><br><span class="line">dataStore.setAttribute(&quot;book&quot;, &quot;professional javascript&quot;);</span><br><span class="line">dataStore.save(&quot;BookInfo&quot;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>读取数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataStore.load(&quot;BookInfo&quot;);</span><br><span class="line">alert(dataStore.getAttribute(&quot;name&quot;));</span><br><span class="line">alert(dataStore.getAttribute(&quot;book&quot;));</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataStore.removeAttribute(&quot;name&quot;);</span><br><span class="line">dataStore.removeAttribute(&quot;book&quot;);</span><br><span class="line">dataStore.save(&quot;BookInfo&quot;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="IE用户数据小结"><a href="#IE用户数据小结" class="headerlink" title="IE用户数据小结"></a>IE用户数据小结</h2><ul>
<li>限制是和cookie是类似的，因为其必须需要同一个域名，同一个路径，相同的脚本协议才可以访问。</li>
<li>都是非安全的，因此都不可以存放敏感数据。</li>
<li>不同点是用户数据是跨会话持久存在的，不会过期，需要手动释放。</li>
</ul>
<h2 id="Web存储机制"><a href="#Web存储机制" class="headerlink" title="Web存储机制"></a>Web存储机制</h2><ul>
<li>Web Storage 的目的是克服由 cookie 带来的一些限制。 {:&amp;.rollIn}</li>
<li>Web Storage可以保证数据被严格控制在客户端上，也无须持续地将数据发回服务器。</li>
<li><p>Web Storage 的两个主要目标是: </p>
<ul>
<li>提供一种在 cookie 之外存储会话数据的途径； </li>
<li>提供一种存储大量可以跨会话存在的数据的机制。</li>
</ul>
</li>
<li><p>最初的 Web Storage 规范包含了两种对象的定义：sessionStorage 和 globalStorage。（以windows对象形式存在） </p>
</li>
<li>支持这两个属性的浏览器包括 IE8+、 Firefox 3.5+、Chrome 4+和 Opera 10.5+。</li>
</ul>
<h2 id="Web存储机制-storage类型"><a href="#Web存储机制-storage类型" class="headerlink" title="Web存储机制   storage类型"></a>Web存储机制   storage类型</h2><ul>
<li>Storage类型提供最大的存储空间（因浏览器而异）来存储名值对</li>
<li><p>只能存储字符串。</p>
<ol>
<li>clear()：删除所有值 {:&amp;.rollIn}</li>
<li>getItem(name)：根据指定的名称name获取对应的值</li>
<li>removeItem(name)：删除由name指定的名值对</li>
<li>setItem(name, value)：为指定的name设置一个对应的值</li>
<li>key(index)：获得index处的值</li>
</ol>
</li>
</ul>
<h2 id="Web存储机制-sessionStorage对象"><a href="#Web存储机制-sessionStorage对象" class="headerlink" title="Web存储机制   sessionStorage对象"></a>Web存储机制   sessionStorage对象</h2><ul>
<li>sessionStorage对象存储是基于会话存在的，如果浏览器关闭，sesssionStorage将会消失。（刷新不会消失）</li>
<li>部分浏览器支持崩溃重启依然可用（firefox和webkit支持，IE不支持）</li>
</ul>
<h2 id="Web存储机制-sessionStorage对象-1"><a href="#Web存储机制-sessionStorage对象-1" class="headerlink" title="Web存储机制   sessionStorage对象"></a>Web存储机制   sessionStorage对象</h2><ul>
<li>sessionStorage对象本质是storage的实例。</li>
<li>有两种存储数据的方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sessionStorage.setItem(&quot;name&quot;,&quot;ctrip&quot;); //使用方法</span><br><span class="line">sessionStorage.book(&quot;javascripe&quot;) ;  // 使用属性</span><br></pre></td></tr></table></figure>
<ul>
<li>类似的，获取、删除也有两种方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//get </span><br><span class="line">var name = sessionStorage.getItem(&quot;name&quot;);  //使用方法</span><br><span class="line">var book = sessionStorage.book;   // 使用属性</span><br><span class="line"></span><br><span class="line">//delete </span><br><span class="line">sessionStorage.removeItem(&quot;name&quot;); //使用方法</span><br><span class="line">delete sessionStorage(&quot;book&quot;);  //使用delete（在webkit中无效）</span><br></pre></td></tr></table></figure>
<h2 id="Web存储机制-sessionStorage对象-IE8写入问题"><a href="#Web存储机制-sessionStorage对象-IE8写入问题" class="headerlink" title="Web存储机制   sessionStorage对象  IE8写入问题"></a>Web存储机制   sessionStorage对象  IE8写入问题</h2><ul>
<li>不同浏览器写入数据略有不同，firefox和webkit实现同步写入。</li>
<li>IE写入数据是异步的，所以设置数据和实际写入有延迟。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//只适用于IE8  强制写入磁盘</span><br><span class="line">sessionStorage.begin();</span><br><span class="line">sessionStorage.name = &quot;ctrip&quot;;</span><br><span class="line">sessionStorage.commit();</span><br></pre></td></tr></table></figure>
<ul>
<li>sessionStorage 对象主要是用于针对会话存储，如果需要跨越会话存储，还需要使用globalStorage和localStorage。</li>
</ul>
<h2 id="Web存储机制-globalStorage对象"><a href="#Web存储机制-globalStorage对象" class="headerlink" title="Web存储机制   globalStorage对象"></a>Web存储机制   globalStorage对象</h2><ul>
<li>firefox2中对此进行了实现。</li>
<li>使用方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">globalStorage[&quot;www.ctrip.com&quot;].name=&quot;ctrip&quot; ;</span><br></pre></td></tr></table></figure>
<ul>
<li>需要指明可以访问的域名，使用方法很不友好。</li>
<li>支持定义域名为空（但不建议使用，存在安全问题），所以需要指定域名。</li>
</ul>
<h2 id="Web存储机制-localStorage对象"><a href="#Web存储机制-localStorage对象" class="headerlink" title="Web存储机制   localStorage对象"></a>Web存储机制   localStorage对象</h2><ul>
<li>在html5规范中，针对持久化保存客户端数据的方案，localStorage用来替代globalStorage。 </li>
<li>因为localStorage对象也是Storage的实例。所以使用方法同sessionStorage，在此不再赘述。</li>
</ul>
<hr>
<ul>
<li>关于浏览器对localStorage和sessionStorage的支持情况</li>
</ul>
<table>
<thead>
<tr>
<th>特性</th>
<th>Chrome</th>
<th>Firefox (Gecko)</th>
<th>Internet Explorer</th>
<th>Opera</th>
<th>Safari (WebKit)</th>
</tr>
</thead>
<tbody>
<tr>
<td>localStorage</td>
<td>4</td>
<td>3.5</td>
<td>8</td>
<td>10.50</td>
<td>4</td>
</tr>
<tr>
<td>sessionStorage</td>
<td>5</td>
<td>2</td>
<td>8</td>
<td>10.50</td>
<td>4</td>
</tr>
</tbody>
</table>
<h2 id="Web存储机制-三者的异同"><a href="#Web存储机制-三者的异同" class="headerlink" title="Web存储机制  三者的异同"></a>Web存储机制  三者的异同</h2><table>
<thead>
<tr>
<th>特性</th>
<th>Cookie</th>
<th>localStorage</th>
<th>sessionStorage</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据的生命期</td>
<td>可设置失效时间，默认是关闭浏览器后失效</td>
<td>除非被清除，否则永久保存</td>
<td>仅在当前会话下有效，关闭页面或浏览器后被清除</td>
</tr>
<tr>
<td>存放数据大小</td>
<td>4K左右</td>
<td>一般为5MB</td>
<td>一般为5MB</td>
</tr>
<tr>
<td>与服务器端通信</td>
<td>每次都会携带在HTTP头中，如果使用cookie保存过多数据会带来性能问题</td>
<td>仅在客户端（即浏览器）中保存，不参与和服务器的通信</td>
<td>仅在客户端（即浏览器）中保存，不参与和服务器的通信</td>
</tr>
<tr>
<td>易用性</td>
<td>需要程序员自己封装，源生的Cookie接口不友好</td>
<td>源生接口可以接受，亦可再次封装来对Object和Array有更好的支持</td>
<td>源生接口可以接受，亦可再次封装来对Object和Array有更好的支持</td>
</tr>
</tbody>
</table>
<h2 id="IndexDB"><a href="#IndexDB" class="headerlink" title="IndexDB"></a>IndexDB</h2><ul>
<li>IndexedDB（对象数据库）可以说是浏览器端数据库，可以被网页脚本程序创建和操作。允许储存大量数据，提供查找接口，建立索引等。</li>
</ul>
<p><img src="/7.10.4.jpg" alt="indexedDB存储结构" title="indexedDB存储结构"></p>
<ul>
<li>IndexedDB最大的特色是：使用对象保存数据，而不是使用表来保存数据。一个IndexedDB数据库，就是一组位于相同命名空间下的对象的集合。</li>
</ul>
<h2 id="IndexDB-操作"><a href="#IndexDB-操作" class="headerlink" title="IndexDB 操作"></a>IndexDB 操作</h2><ul>
<li>创建数据库  {:&amp;.rollIn}</li>
<li>对象存储空间</li>
<li>事物</li>
<li>游标</li>
<li>键范围</li>
<li>索引</li>
</ul>
<h2 id="IndexDB-安全性限制和使用场景"><a href="#IndexDB-安全性限制和使用场景" class="headerlink" title="IndexDB 安全性限制和使用场景"></a>IndexDB 安全性限制和使用场景</h2><ul>
<li>IndexedDB 使用同源原则，这意味着它把存储空间绑定到了创建它的站点的源（典型情况下，就是站点的域或是子域），所以它不能被任何其他源访问。   {:&amp;.rollIn}</li>
<li>要着重指出的一点是，IndexedDB 不适用于从另一个站点加载进框架的内容 (不管是用 frame 还是 iframe)。</li>
<li>由于前端数据库需求较少，并且IndexDB对IOS和早期的android支持很不友好，因此使用场景较少。</li>
</ul>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul>
<li>离线检测   {:&amp;.rollIn}<ul>
<li>navigator.onLine</li>
</ul>
</li>
<li>离线缓存<ul>
<li>使用描述文件做appcache</li>
</ul>
</li>
<li>浏览器保存数据<ul>
<li>Cookie</li>
<li>IE 用户数据</li>
<li>stroge<ul>
<li>sessionStorge</li>
<li>globalStorage(localStorage)</li>
</ul>
</li>
<li>IndexDB</li>
</ul>
</li>
<li>虽然有了这些技术，我们可以在浏览器上存储大量数据。但是有一点仍需要注意的就是，客户端存在安全隐患，不应该存储隐私敏感数据。</li>
</ul>

      
    </div>
    
    
    

    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
      
    </div>

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/js/" rel="tag"><i class="fa fa-tag"></i> js</a>
          
            <a href="/tags/offline/" rel="tag"><i class="fa fa-tag"></i> offline</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/nodeppt.html" rel="next" title="nodeppt的使用">
                <i class="fa fa-chevron-left"></i> nodeppt的使用
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/eslint.html" rel="prev" title="eslint的使用">
                eslint的使用 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="洪杨" />
            
              <p class="site-author-name" itemprop="name">洪杨</p>
              <p class="site-description motion-element" itemprop="description">生活不止有苟且，还有读不懂的诗和到不了的远方。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#web应用和传统客户端的比较"><span class="nav-number">1.</span> <span class="nav-text">web应用和传统客户端的比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开发离线应用"><span class="nav-number">2.</span> <span class="nav-text">开发离线应用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#离线检测"><span class="nav-number">3.</span> <span class="nav-text">离线检测</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#离线检测-h5事件"><span class="nav-number">4.</span> <span class="nav-text">离线检测 h5事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用缓存"><span class="nav-number">5.</span> <span class="nav-text">应用缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#描述文件以及使用"><span class="nav-number">6.</span> <span class="nav-text">描述文件以及使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#applicationCache-对象属性"><span class="nav-number">7.</span> <span class="nav-text">applicationCache 对象属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#applicationCache-对象事件"><span class="nav-number">8.</span> <span class="nav-text">applicationCache 对象事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#applicationCache-对象方法"><span class="nav-number">9.</span> <span class="nav-text">applicationCache 对象方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cookie（HTTP-Cookie）"><span class="nav-number">10.</span> <span class="nav-text">Cookie（HTTP Cookie）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cookie-限制"><span class="nav-number">11.</span> <span class="nav-text">Cookie 限制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cookie-结构"><span class="nav-number">12.</span> <span class="nav-text">Cookie 结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cookie-结构-1"><span class="nav-number">13.</span> <span class="nav-text">Cookie 结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#javascript中的Cookie"><span class="nav-number">14.</span> <span class="nav-text">javascript中的Cookie</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JavaScript-Cookie操作扩展"><span class="nav-number">15.</span> <span class="nav-text">JavaScript Cookie操作扩展</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#子cookie"><span class="nav-number">16.</span> <span class="nav-text">子cookie</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IE用户数据"><span class="nav-number">17.</span> <span class="nav-text">IE用户数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IE用户数据的操作"><span class="nav-number">18.</span> <span class="nav-text">IE用户数据的操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IE用户数据小结"><span class="nav-number">19.</span> <span class="nav-text">IE用户数据小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web存储机制"><span class="nav-number">20.</span> <span class="nav-text">Web存储机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web存储机制-storage类型"><span class="nav-number">21.</span> <span class="nav-text">Web存储机制   storage类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web存储机制-sessionStorage对象"><span class="nav-number">22.</span> <span class="nav-text">Web存储机制   sessionStorage对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web存储机制-sessionStorage对象-1"><span class="nav-number">23.</span> <span class="nav-text">Web存储机制   sessionStorage对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web存储机制-sessionStorage对象-IE8写入问题"><span class="nav-number">24.</span> <span class="nav-text">Web存储机制   sessionStorage对象  IE8写入问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web存储机制-globalStorage对象"><span class="nav-number">25.</span> <span class="nav-text">Web存储机制   globalStorage对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web存储机制-localStorage对象"><span class="nav-number">26.</span> <span class="nav-text">Web存储机制   localStorage对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web存储机制-三者的异同"><span class="nav-number">27.</span> <span class="nav-text">Web存储机制  三者的异同</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IndexDB"><span class="nav-number">28.</span> <span class="nav-text">IndexDB</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IndexDB-操作"><span class="nav-number">29.</span> <span class="nav-text">IndexDB 操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IndexDB-安全性限制和使用场景"><span class="nav-number">30.</span> <span class="nav-text">IndexDB 安全性限制和使用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结"><span class="nav-number">31.</span> <span class="nav-text">小结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">洪杨</span>

  <span class="post-meta-divider">|</span>
  <span>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
</html>
